<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http; // Ito ang kailangan para makatawag sa API

class PublicBookingController extends Controller
{
    // Dito ilalagay ang method o function
    public function bookHotel(Request $request)
    {
        // 1. Kunin ang URL ng Aureliya Service mula sa .env
        $aureliyaUrl = env('AURELIYA_SERVICE_URL'); 
        // Note: Siguraduhin na may AURELIYA_SERVICE_URL=http://localhost:8002/api sa iyong .env file

        // 2. Ihanda ang data na ipapasa (galing sa Frontend niyo)
        $bookingData = [
            'user_id'     => $request->user_id,
            'property_id' => $request->property_id,
            'start_date'  => $request->start_date,
            'end_date'    => $request->end_date,
            'guests'      => $request->guests,
            // ... dagdag pa kung ano ang hinihingi ng Aureliya API
        ];

        // 3. Tumawag sa Aureliya API (POST Request)
        // Target URL: http://localhost:8002/api/aureliya/bookings
        $response = Http::post("{$aureliyaUrl}/aureliya/bookings", $bookingData);

        // 4. Check kung successful ang tawag
        if ($response->successful()) {
            return response()->json([
                'message' => 'Hotel booked successfully via Aureliya!',
                'data' => $response->json()
            ], 201);
        }

        // 5. Kung nag-fail, ibalik ang error galing sa Aureliya
        return response()->json([
            'message' => 'Booking failed',
            'error' => $response->json()
        ], $response->status());
    }
}